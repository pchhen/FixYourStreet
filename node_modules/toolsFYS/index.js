var express = require('express'),
  router = express.Router(),
  mongoose = require('mongoose'),
  User = mongoose.model('User');

module.exports = {
  // Very Basic authentification system


  CheckStaffAuthorization: function (req, res, next){
    User.findById(req.get("X-USERID"), function(err, user) {
      if (err) {
          res.status(500).send(err);
          return;
      } else if (!user) {
          res.status(404).send('User not found');
          return;
      }else if((user.password != req.get("X-USERHASH")) || (user.role != 'staff')){
          res.status(403).send('User not authorized');
          return;
      }
      req.userRole = user.role;
      next();
    });
  },
  CheckCitizenAuthorization: function (req, res, next){
    User.findById(req.get("X-USERID"), function(err, user) {
      if (err) {
          res.status(500).send(err);
          return;
      } else if (!user) {
          res.status(404).send('User not found');
          return;

      // The role definition
      // The citizen has basic rights and the staff has more advanced rights
      }else if((user.password != req.get("X-USERHASH")) || ((user.role != 'citizen') && (user.role != 'staff'))){
          res.status(403).send('User not authorized');
          return;
      }
      next();
    });
  },
};
